import{c as s,d as o,n as E,b as c,o as T,e as u,s as I,j as $,t as g,F as j,h as A,x as B,i as O,l as R,u as L,k as F,a as M,m as P,L as H,p as U}from"./index-60ce0b05.js";function V(t,l){t=Math.abs(t)%100;var a=t%10;return t>10&&t<20?l[2]:a>1&&a<5?l[1]:a==1?l[0]:l[2]}const J="/assets/user-19bf8114.svg",W=["disabled"],z={key:0},G={key:1},Y={__name:"RequestButton",props:{sended:Boolean},emits:["submit"],setup(t,{emit:l}){const a=l;return(q,e)=>(s(),o("button",{onClick:e[0]||(e[0]=f=>a("submit")),disabled:t.sended,class:E(["transition-all rounded-full w-[200px] h-[44px] uppercase flex justify-center items-center",t.sended?"bg-[#F1F1F1] text-black":"bg-button_color text-white"])},[t.sended?(s(),o("span",z,"Запрос отправлен")):(s(),o("span",G,"Отправить запрос"))],10,W))}},K={class:"rounded-xl relative bg-secondary_bg_color flex flex-col px-4 pb-10 pt-16 gap-y-4 mt-10"},Q={class:"flex justify-center absolute w-full left-0 right-0 -top-12"},X={class:"w-24 h-24 rounded-full bg-bg_color border-2 border-secondary_bg_color flex justify-center items-center overflow-hidden"},Z={key:0,src:J,class:"w-12 object-contain"},ee=["src"],te={class:"flex flex-col justify-center gap-y-4"},se={class:"text-center font-sera_bold text-lg"},ae={class:"flex gap-2 flex-wrap"},oe={key:0,class:"text-sm whitespace-pre-wrap"},ne={key:1,class:"text-sm whitespace-pre-wrap"},ue={class:"flex justify-center absolute w-full left-0 right-0 -bottom-5"},le={__name:"UserCard",props:{user:Object,senderId:Number,useRequestPerDay:Number,requestsPerDay:Number,sended:Boolean},emits:["requestsContact"],setup(t,{emit:l}){const a=t,q=l,e=c(!1),f=window.Telegram.WebApp,_=c(null);T(()=>{_.value=a.sended});function D(d){let h=JSON.parse(window.localStorage.getItem("requests"))||[];h.push(d),window.localStorage.setItem("requests",JSON.stringify(h))}const r=()=>{if(a.useRequestPerDay>=a.requestsPerDay)return f.showAlert(`Ежедневно можно отправить не более ${a.requestsPerDay} запросов`);f.showConfirm("Вы готовы поделиться своим контактом?",d=>{d&&(_.value=!0,D(a.user.id),q("requestsContact",a.user))})};return(d,h)=>{var b,y,m,N,w,S,x,i,p,n,v;return s(),o("div",K,[u("div",Q,[u("div",X,[(b=t.user.attributes.photo)!=null&&b.data?(s(),o("img",{key:1,src:`https://${I($).API.HOST}.${I($).DOMAIN}${(N=(m=(y=t.user.attributes.photo)==null?void 0:y.data)==null?void 0:m.attributes)==null?void 0:N.url}`,class:"object-contain"},null,8,ee)):(s(),o("img",Z))])]),u("div",te,[u("h3",se,g((w=t.user.attributes)==null?void 0:w.firstName)+" "+g((S=t.user.attributes)==null?void 0:S.surname),1),u("div",ae,[(s(!0),o(j,null,A(t.user.attributes.suggests.data,k=>(s(),o("span",{class:"text-sm px-2.5 py-1 rounded-full border-2 border-text_color opacity-50",key:k.id},g(k.attributes.title),1))),128))]),e.value?(s(),o("p",oe,g((x=t.user.attributes)==null?void 0:x.about),1)):(s(),o("p",ne,[B(g(((i=t.user.attributes)==null?void 0:i.about.length)>120?((p=t.user.attributes)==null?void 0:p.about.slice(0,120))+"...":(n=t.user.attributes)==null?void 0:n.about)+" ",1),((v=t.user.attributes)==null?void 0:v.about.length)>120?(s(),o("span",{key:0,onClick:h[0]||(h[0]=k=>e.value=!e.value),class:"font-sera_bold cursor-pointer text-button_color underline"},"Развернуть")):O("",!0)]))]),u("div",ue,[R(Y,{sended:_.value,onSubmit:r},null,8,["sended"])])])}}},re={key:0,class:"flex flex-col p-4 pb-10 gap-y-4"},ie={key:0,class:"flex flex-col gap-y-4"},ce={class:"font-sera_bold"},de=u("h1",{class:"text-lg font-sera_bold"},"Вам предлагают:",-1),be={key:0,class:"flex flex-col gap-y-12"},ve={key:1,class:"text-sm"},fe={key:2,class:"flex justify-center pt-4"},he=u("span",{className:"loading loading-spinner loading-lg text-button_color"},null,-1),pe=[he],me={key:1},ge=u("span",null,"Ваш профиль находится на модерации, пожалуйста, ожидайте. Скоро вам будет доступен полный функционал нетворкинга!",-1),_e=[ge],C=10,we={__name:"Index",setup(t){var x;const l=c(!0),a=L(),q=((x=window.Telegram.WebApp.initDataUnsafe.user)==null?void 0:x.id)||$.BOT.TEST_USER,e=c(null),f=window.Telegram.WebApp,_=F(),D=()=>{_.go(-1)},r=c(null),d=c(1),h=c(10),b=c(null),y=c(null);T(()=>{window.addEventListener("scroll",w),f.BackButton.show(),f.onEvent("backButtonClicked",D),y.value=JSON.parse(window.localStorage.getItem("requests"))||[],(async()=>{if(e.value=await a.getUserData(q),e.value.attributes.publishedAt){let p=e.value.attributes.lookingFors.data.map(v=>v.id);r.value=await a.getContacts(e.value.id,p,d.value,h.value);const{meta:{pagination:{total:n}}}=await a.getConnectsPerDayById(e.value.id);b.value=n}l.value=!1})()}),M(()=>{window.removeEventListener("scroll",w),f.BackButton.hide(),f.offEvent("backButtonClicked",D)});const m=c(!1),N=async()=>{var i;if((i=r.value)!=null&&i.data&&r.value.data.length<r.value.meta.pagination.total){m.value=!0,d.value=d.value+1;let p=e.value.attributes.lookingFors.data.map(v=>v.id),n=await a.getContacts(e.value.id,p,d.value,h.value);if(!n)return;r.value.data=[...r.value.data,...n.data]}m.value=!1},w=()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight&&(m.value||N())},S=async i=>{var n;if(await a.addConnects(e.value.id,i.id)){b.value=Number(b.value)+1;let v=null;(n=e.value.attributes.photo)!=null&&n.data&&(v=`https://${$.API.HOST}.${$.DOMAIN}${e.value.attributes.photo.data.attributes.url}`);const k=`<b>С Вами хотят связаться!</b>

<b>Пользователь:</b> ${e.value.attributes.firstName} ${e.value.attributes.surname}

<b>Общая информация:</b>
${e.value.attributes.about}

<b>Контакты:</b>
<b>Номер:</b> +${e.value.attributes.phone}
<b>Email-адрес:</b> ${e.value.attributes.email}
<b>TG:</b> <a href='tg://user?id=${e.value.attributes.chatId}'>${e.value.attributes.username||e.value.attributes.firstName}</a>`;await a.sendMessage(k,v,i.attributes.chatId,[])}};return(i,p)=>l.value?(s(),P(U,{key:1})):(s(),o("div",re,[R(H),e.value.attributes.publishedAt&&(e.value.attributes.status=="adopted"||!e.value.attributes.status)?(s(),o("div",ie,[u("div",null,[u("span",null,[B("Сегодня у вас осталась возможность отправить "),u("b",ce,g(C-b.value),1),B(" "+g(I(V)(C-b.value,["запрос","запроса","запросов"])),1)]),de]),r.value.data&&r.value.data.length>0?(s(),o("div",be,[(s(!0),o(j,null,A(r.value.data,n=>(s(),P(le,{key:n.id,user:n,senderId:e.value.id,onRequestsContact:S,useRequestPerDay:b.value,requestsPerDay:C,sended:y.value.includes(n.id)},null,8,["user","senderId","useRequestPerDay","sended"]))),128))])):(s(),o("span",ve," К сожалению, контакты по Вашим критериям еще не добавлены. Попробуйте зайти позже. ")),m.value?(s(),o("div",fe,pe)):O("",!0)])):(s(),o("div",me,_e))]))}};export{we as default};
